<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon CAD - Engineering</title>
    
    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –°–¢–ò–õ–ï–ô -->
    <link rel="stylesheet" href="./src/style.css">
    <!-- –®—Ä–∏—Ñ—Ç –¥–ª—è CAD –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* –ü—Ä–µ–ª–æ–∞–¥–µ—Ä: —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ */
        body {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-in;
            background-color: #0f1115;
            overflow: hidden;
        }
        body.loaded {
            opacity: 1;
            visibility: visible;
        }
    </style>

    <!-- API –Ø–Ω–¥–µ–∫—Å–∞ -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=b937403b-296f-43ed-9b61-aaa6b8a99e03&lang=ru_RU" type="text/javascript"></script>
</head>
<body>

    <!-- UI –≠–ª–µ–º–µ–Ω—Ç—ã -->
    <div id="save-indicator"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>

    <!-- –ü–†–ò–¶–ï–õ (–°—Ç–∞—Ç–∏—á–Ω—ã–π –ø–æ —Ü–µ–Ω—Ç—Ä—É) -->
    <div id="center-target">
        <svg viewBox="0 0 40 40">
            <circle cx="20" cy="20" r="18" fill="none" stroke="var(--neon-blue)" stroke-width="2" opacity="0.5"/>
            <line x1="20" y1="0" x2="20" y2="40" stroke="var(--active-color)" stroke-width="2"/>
            <line x1="0" y1="20" x2="40" y2="20" stroke="var(--active-color)" stroke-width="2"/>
            <circle cx="20" cy="20" r="2" fill="var(--danger-color)"/>
        </svg>
    </div>

    <!-- –ö–ù–û–ü–ö–ê –î–ï–ô–°–¢–í–ò–Ø (FAB) -->
    <button id="btn-action-main">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="#fff"/></svg>
        <span>–î–û–ë–ê–í–ò–¢–¨</span>
    </button>

    <div id="left-panel">
        <div id="tool-trigger"><svg class="trigger-icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg><span class="trigger-text" id="active-tool-name">–ò–ù–°–¢–†–£–ú–ï–ù–¢</span></div>
        <div id="esc-btn">ESC</div>
    </div>

    <div id="tools-menu">
        <button class="minimal-btn" data-tool="line" data-label="–õ–∏–Ω–∏—è">–õ–∏–Ω–∏—è (–ö–∞–±–µ–ª—å)</button>
        <button class="minimal-btn" data-tool="polygon" data-label="–ü–æ–ª–∏–≥–æ–Ω">–ü–æ–ª–∏–≥–æ–Ω (–ó–æ–Ω–∞)</button>
        <button class="minimal-btn" data-tool="subscriber" data-label="–ê–±–æ–Ω–µ–Ω—Ç">–ê–±–æ–Ω–µ–Ω—Ç (–î–æ–º)</button>
        <button class="minimal-btn" data-tool="light" data-label="–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫">–°–≤–µ—Ç–∏–ª—å–Ω–∏–∫</button>
        <button class="minimal-btn" data-tool="pole" data-label="–û–ø–æ—Ä–∞">–û–ø–æ—Ä–∞</button>
        <button class="minimal-btn" data-tool="cabinet" data-label="–®–∫–∞—Ñ">–®–∫–∞—Ñ</button>
        <button class="minimal-btn" data-tool="flag" data-label="–§–ª–∞–≥">–§–ª–∞–≥</button>
        <button class="minimal-btn" data-tool="star" data-label="–ó–≤–µ–∑–¥–∞">–ó–≤–µ–∑–¥–∞</button>
        <button class="minimal-btn" data-tool="substation" data-label="–¢–ü">–¢–ü</button>
        <button class="minimal-btn" data-tool="text" data-label="–¢–µ–∫—Å—Ç">–¢–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫</button>
    </div>

    <div id="context-menu"></div>

    <div id="modal-overlay">
        <div id="modal-box">
            <h3>–ü–æ–¥–ø–∏—Å—å –æ–±—ä–µ–∫—Ç–∞</h3>
            <input type="text" id="modal-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..." >
            <div class="modal-btns">
                <button id="btn-modal-cancel" class="modal-btn">–û—Ç–º–µ–Ω–∞</button>
                <button id="btn-modal-save" class="modal-btn" style="background:#00AEEF;color:#fff;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="cable-modal-overlay">
        <div id="cable-modal-box">
            <div class="modal-header">–°–≤–æ–π—Å—Ç–≤–∞ –∫–∞–±–µ–ª—è</div>
            <div class="form-group">
                <label>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</label>
                <div class="select-wrapper">
                    <select id="cable-type-select">
                        <option value="power">–°–∏–ª–æ–≤–∞—è –ª–∏–Ω–∏—è (–≠–ª–µ–∫—Ç—Ä–∏–∫–∞)</option>
                        <option value="low_current">–°–ª–∞–±–æ—Ç–æ—á–Ω–∞—è –ª–∏–Ω–∏—è</option>
                        <option value="fiber">–û–ø—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∏—è (–í–û–õ–°)</option>
                    </select>
                </div>
            </div>
            <div id="cable-dynamic-fields"></div>
            <div class="form-group">
                <label>–°–ø–æ—Å–æ–± –ø—Ä–æ–∫–ª–∞–¥–∫–∏</label>
                <div class="select-wrapper">
                    <select id="cable-install-select">
                        <option value="air">–í–æ–∑–¥—É—à–Ω–∞—è (–í–õ / –í–õ–ò)</option>
                        <option value="ground">–ü–æ–¥–∑–µ–º–Ω–∞—è (–í –≥—Ä—É–Ω—Ç–µ)</option>
                        <option value="water">–ü–æ–¥–≤–æ–¥–Ω–∞—è</option>
                        <option value="building">–ü–æ —Ñ–∞—Å–∞–¥—É / –í–Ω—É—Ç—Ä–∏ –∑–¥–∞–Ω–∏—è</option>
                    </select>
                </div>
            </div>
            <div class="modal-btns">
                <button id="btn-cable-cancel" class="modal-btn secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="btn-cable-save" class="modal-btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="top-toolbar">
        <div class="search-box">
            <svg class="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <input type="text" id="search-input" placeholder="–ê–¥—Ä–µ—Å..." enterkeyhint="search" >
        </div>
        <div class="divider"></div>
        <div id="palette" style="display:flex; gap:8px;"></div>
        
        <button id="btn-eraser" class="icon-btn" title="–õ–∞—Å—Ç–∏–∫">
            <svg viewBox="0 0 24 24"><path d="M15.14 3c.51 0 1.02.2 1.41.59l2.86 2.86c.78.78.78 2.05 0 2.83l-7.03 7.03-8.8-8.81 7.03-7.02c.39-.39.9-.59 1.41-.59h.12zM5.5 16.7L12 10.2l6.5 6.5-1.41 1.41-5.09-5.09-5.09 5.09L5.5 16.7zM18 19v2H6v-2h12z"/></svg>
        </button>

        <div class="divider"></div>
        
        <!-- –ö–ù–û–ü–ö–ê –°–¢–ò–õ–Ø -->
        <button id="btn-style" class="icon-btn" title="–°—Ç–∏–ª—å –ª–∏–Ω–∏–∏">
            <svg viewBox="0 0 24 24"><path d="M3 17h18v2H3zm0-5h18v2H3zm0-5h18v2H3z"/></svg>
        </button>

        <div class="divider"></div>
        <button id="btn-ruler" class="icon-btn active" title="–†–∞–∑–º–µ—Ä—ã"><svg viewBox="0 0 24 24"><path d="M21.66 10.25L13.75 2.34c-.39-.39-1.02-.39-1.41 0L2.34 12.34c-.39.39-.39 1.02 0 1.41l7.91 7.91c.39.39 1.02.39 1.41 0l10-10c.39-.39.39-1.02 0-1.41zM6.59 16L4 13.41l1-1 1 1 1.41-1.41-1-1 1.42-1.42 1 1 1.41-1.41-1-1 3.54-3.54L19.25 10.5 6.59 16z"/></svg></button>
        
        <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê: –†–µ–∂–∏–º –ø—Ä–∏—Ü–µ–ª–∞ -->
        <button id="btn-target-mode" class="icon-btn" title="–†–µ–∂–∏–º –ø—Ä–∏—Ü–µ–ª–∞ (–ú–æ–±–∏–ª—å–Ω—ã–π)">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v4h4v2h-4v4h-2v-4H7v-2h4V7z"/></svg>
        </button>

        <div class="opacity-control" title="–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å"><svg class="opacity-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" /><circle cx="12" cy="12" r="3" fill="#fff" stroke="none" /></svg><input type="range" id="opacity-slider" min="10" max="100" value="100" ></div>
        <div class="opacity-control" title="–†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–æ–∫"><svg class="opacity-icon" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg><input type="range" id="icon-scale-slider" min="20" max="200" value="100" ></div>
        <div class="opacity-control" title="–ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞"><svg class="opacity-icon" viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg><input type="range" id="map-dimmer" min="10" max="100" value="100" ></div>
        
        <div class="divider"></div>
        <button id="btn-poi" class="icon-btn" title="–í–∫–ª/–û—Ç–∫–ª –æ–±—ä–µ–∫—Ç—ã –∫–∞—Ä—Ç—ã (POI)"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></button>
        <div class="divider"></div>
        <button id="btn-groups" class="icon-btn" title="–ì—Ä—É–ø–ø—ã / –°–ª–æ–∏"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5 9.5 9.75 12 11zm0 2.5l-5-2.5-5 2.5 10 5 10-5-5-2.5-5 2.5z"/></svg></button>
        <div class="divider"></div>
        <button id="btn-bom" class="icon-btn" title="–°–º–µ—Ç–∞ (BOM)"><svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg></button>
        <div class="divider"></div>
        <button id="btn-save" class="icon-btn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"><svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg></button>
        <button id="btn-load" class="icon-btn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å"><svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7l-4-4zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.83V17h2v-4.17l1.59 1.59L16 13.01 12.01 9 8 13.01z"/></svg></button>
        <button id="btn-clear" class="icon-btn" title="–û—á–∏—Å—Ç–∏—Ç—å"><svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>
    </div>

    <div id="info-bar">
        <span class="info-label">Z:</span><span id="zoom-val">--</span>
        <div class="info-divider"></div>
        <span class="info-label">Storage:</span><span id="storage-val">0</span> KB
    </div>

    <div id="help-toggle-btn">?</div>
    <div id="help-panel" class="side-panel">
        <div class="panel-header">
            <div class="panel-icon-title"><span>–°–ø—Ä–∞–≤–∫–∞</span></div>
            <div class="panel-close">‚úï</div>
        </div>
        <div class="panel-body">
            <div class="help-section">
                <div class="help-title">üñ± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é</div>
                <div class="help-item"><span class="key-badge">–õ–ö–ú</span> –ü–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ—á–∫—É / –í—ã–±—Ä–∞—Ç—å</div>
                <div class="help-item"><span class="key-badge">–ü–ö–ú</span> –°–≤–æ–π—Å—Ç–≤–∞ / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</div>
            </div>
            <div class="help-section">
                <div class="help-title">‚å® –ö–ª–∞–≤–∏—à–∏</div>
                <div class="help-item"><span class="key-badge">ESC</span> –û—Ç–º–µ–Ω–∞ / –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é</div>
                <div class="help-item"><span class="key-badge">TAB</span> –ú–µ–Ω—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</div>
            </div>
            <div class="help-section">
                <div class="help-title">üì± –ú–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</div>
                <div class="help-item">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å –ø—Ä–∏—Ü–µ–ª–æ–º –≤ –º–µ–Ω—é, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º –Ω–∞–≤–µ–¥–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–æ–º —ç–∫—Ä–∞–Ω–∞.</div>
            </div>
        </div>
    </div>

    <div id="groups-panel" class="side-panel">
        <div class="panel-header">
            <div class="panel-icon-title"><span>–ì—Ä—É–ø–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤</span></div>
            <div class="panel-close">‚úï</div>
        </div>
        <div class="panel-body">
            <div id="groups-list"></div>
            <button class="btn-add-group">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg> –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
            </button>
        </div>
    </div>

    <div id="bom-panel" class="side-panel">
        <div class="panel-header">
            <div class="panel-icon-title"><span>–°–º–µ—Ç–∞ (BOM)</span></div>
            <div class="panel-close">‚úï</div>
        </div>
        <div class="panel-body" id="bom-content"></div>
    </div>

    <!-- –í–´–ü–ê–î–ê–Æ–©–ï–ï –û–ö–ù–û –°–¢–ò–õ–ï–ô - –¢–ï–ü–ï–†–¨ –û–¢–î–ï–õ–¨–ù–û –í BODY -->
    <div id="style-dropdown" class="toolbar-dropdown">
        <div class="style-option" data-style="solid" title="–°–ø–ª–æ—à–Ω–∞—è"><div class="line-preview solid"></div></div>
        <div class="style-option" data-style="dash" title="–ü—É–Ω–∫—Ç–∏—Ä"><div class="line-preview dash"></div></div>
        <div class="style-option" data-style="dot" title="–¢–æ—á–∫–∞"><div class="line-preview dot"></div></div>
    </div>

    <input type="file" id="file-input" accept=".json" >
    <div id="map"></div>

    <!-- SVG Defs -->
    <svg style="display: none;">
        <defs>
            <symbol id="icon-cabinet" viewBox="0 0 24 24">
                <rect x="4" y="4" width="16" height="16" fill="#111" stroke="var(--obj-color)" stroke-width="2"/>
                <line x1="4" y1="4" x2="20" y2="20" stroke="var(--obj-color)" stroke-width="1.5"/>
                <line x1="20" y1="4" x2="4" y2="20" stroke="var(--obj-color)" stroke-width="1.5"/>
            </symbol>
            <symbol id="icon-flag" viewBox="0 0 24 24">
                <path d="M5 21V5h14l-2 5 2 5H7v6h-2z" fill="none" stroke="var(--obj-color)" stroke-width="2" stroke-linejoin="round"/>
            </symbol>
            <symbol id="icon-star" viewBox="0 0 24 24">
                <path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5-6.5 4.5 2-7-5.5-4h7z" fill="none" stroke="var(--obj-color)" stroke-width="2" stroke-linejoin="round"/>
            </symbol>
            <symbol id="icon-substation" viewBox="0 0 24 24">
                <rect x="2" y="2" width="20" height="20" fill="#111" stroke="var(--obj-color)" stroke-width="2"/>
                <circle cx="8" cy="8" r="3" stroke="var(--obj-color)" stroke-width="1.5" fill="none"/>
                <circle cx="16" cy="16" r="3" stroke="var(--obj-color)" stroke-width="1.5" fill="none"/>
            </symbol>
            <symbol id="icon-pole" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="8" fill="#111" stroke="var(--obj-color)" stroke-width="2"/>
                <line x1="12" y1="4" x2="12" y2="20" stroke="var(--obj-color)" stroke-width="1.5"/>
                <line x1="4" y1="12" x2="20" y2="12" stroke="var(--obj-color)" stroke-width="1.5"/>
            </symbol>
            <symbol id="icon-house" viewBox="0 0 24 24">
                <rect x="5" y="5" width="14" height="14" fill="#111" stroke="var(--obj-color)" stroke-width="2"/>
                <path d="M5 5L19 19" stroke="var(--obj-color)" stroke-width="1" stroke-dasharray="2 2"/>
            </symbol>
        </defs>
    </svg>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JavaScript –º–æ–¥—É–ª—å -->
    <script type="module" src="./src/main.js"></script>
</body>
</html>